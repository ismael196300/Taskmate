<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskmate</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <script type="text/javascript">
        (function(){
            emailjs.init({
                publicKey: "2vPqEDSX0mBOwri4S",
            });
        })();
        </script>
</head>
<body>
    <form action="main.html" method="post">
   
    <div class="wrapper">
        <div class="heade">
            <img src="logo.png" alt="LOGO" class="logo" width="60px"height="60px">
            <p><span>TASKMATE</span></p>
        </div>
            <div class="div-move" id="div-move">
                <h2 class="title-login">Log In</h2>
                <p class="message-code-para">A Verfication Code <br>has been sent to your Email.</p>
                <div class="input-box forgot-email" id="forgot-email">
                    <box-icon type='solid' name='envelope'></box-icon>
                    <input type="email" name="userEmail" id="userEmail" placeholder="Email" required autocomplete="email">
                </div>
                <p class="forgot-email-para" id="forgot-email-para">Email not found.</p>
                <div class="input-box" id="input-code">
                  
                    <input type="text" name="code" id="input-number" placeholder="Code" required maxlength="6" >
                </div>

                <div class="input-box" id="input-username">
                    <box-icon type='solid' name='user'></box-icon>
                    <input type="text" name="username" id="loginUsername" placeholder="Username or Email" required autocomplete="username">
                </div>
                <div class="input-box" id="input-password">   
                    <box-icon type='solid' name='lock-alt' class="imgLock" title="Show Password" id="logoPassword" onclick="togglePasswordVisibility()"></box-icon>
                    <input type="password" id="loginPassword" name="password" placeholder="Password"required autocomplete="current-password">
                
                </div>
                <div class="input-box" id="input-change-password">   
                    <box-icon type='solid' name='lock-alt' class="imgLock" title="Show Password" id="logoNewPassword" onclick="toggleForgotPasswordVisibility()"></box-icon>
                    <input type="password" id="changePassword" name="changePassword" placeholder="New Password"required autocomplete="current-password">
                
                </div>
                <p class="old-password-para">Old password recognized. <br> Kindly select a new one.</p>
                <div class="input-box" id="input-confirm-change-password">   
                    <box-icon type='solid' name='lock-alt' class="imgLock" title="Show Password" id="logoConfirmPassword" onclick="toggleForgotConfirmPasswordVisibility()"></box-icon>
                    <input type="password" id="confirmChangePassword" name="confirmChangePassword" placeholder="Confirm Password"required autocomplete="current-password">
                </div>
                    <p class="success-change-para">Password successfully changed. <br> You may now proceed to login.</p>
                    <p id="log-para" class="log-para">Incorrect Username/Email or Password.</p>
                    <p class="invalid-pass-para" id="invalid-pass-para">Password does'nt Match.</p>
                    <div class="btn-password">
                        <p class="btn-forgot-password" id="btn-forgot-password">Forgot Password?</p>
                    </div>
                
                <button type="button" class="btnLogin" id="btnLogin">Log In</button>
                <button type="button" class="btn-send-code" id="btn-send-code">Send Code</button>
                <button type="button" class="btn-check-code" id="btn-check-code">Confirm</button>
                <button type="button" class="btn-change-password" id="btn-change-password">Change Password</button>
                <p class="wrong-code-para" id="wrong-code-para">Incorrect Code</p>
                <div class="sign-up-link">
             </div>
                <p class="btn-signup">Don't have an account? <a href="signup.html"> Sign Up</a></p>
                <p class="back-to-login">Back to Log in</p>
            </div>
           
    </div>
        </form>
    <script>
        function hasNoCapitalLetters(input) {
            return /^[^A-Z]*$/.test(input);
        }
        function hasNoNumbers(input) {
            return /^[^0-9]*$/.test(input);
        }
        function hasNoLetters(input) {
            return /^[^a-zA-Z]*$/.test(input);
        }
        function hasNoSpecialCharacters(input) {
            return /[^\w\s]/.test(input);
        }
        document.querySelector(".old-password-para").style.display = "none"
        document.querySelector(".success-change-para").style.display = "none"
        document.querySelector(".message-code-para").style.display = "none"
        document.getElementById("forgot-email").style.display = "none"
        document.querySelector(".back-to-login").style.display = "none"
        document.querySelector(".btn-send-code").style.display = "none"
        
        document.querySelector("#input-code").style.display = "none"
        document.querySelector(".forgot-email-para").style.display = "none"
        document.getElementById("wrong-code-para").style.display ="none"
        document.getElementById("btn-check-code").style.display ="none"
        document.getElementById("btn-change-password").style.display ="none"
        document.getElementById("input-change-password").style.display = "none"
        document.getElementById("input-confirm-change-password").style.display = "none"
        document.querySelector("#invalid-pass-para").style.display = "none"

        document.getElementById("btn-forgot-password").addEventListener("click",()=>{
            logPara.style.display = "none";
            document.getElementById("loginUsername").value = ""
            document.getElementById("loginPassword").value = ""
            document.getElementById("forgot-email").style.display = "block"
            document.querySelector(".back-to-login").style.display = "block"
            document.querySelector("#input-username").style.display = "none"
            document.querySelector("#input-password").style.display = "none"
            document.getElementById("btnLogin").style.display = "none"
            document.querySelector(".btn-signup").style.display = "none"
            document.querySelector(".title-login").textContent = "Recover Account"
            document.getElementById("btn-forgot-password").style.display = "none"
            document.querySelector(".btn-send-code").style.display = "block"
        })
        document.querySelector(".back-to-login").addEventListener("click",()=>{
            document.querySelector("#userEmail").value = ""
            document.getElementById("confirmChangePassword").value = ""
            document.getElementById("changePassword").value = ""
            document.querySelector("#input-code").style.display = "none"
            document.getElementById("forgot-email").style.display = "none"
            document.querySelector(".back-to-login").style.display = "none"
            document.querySelector("#input-username").style.display = "block"
            document.querySelector("#input-password").style.display = "block"
            document.getElementById("btnLogin").style.display = "block"
            document.querySelector(".btn-signup").style.display = "block"
            document.querySelector(".title-login").textContent = "Log in"
            document.getElementById("btn-forgot-password").style.display = "block"
            document.querySelector(".btn-send-code").style.display = "none"
            document.querySelector(".forgot-email-para").style.display = "none"
            document.getElementById("wrong-code-para").style.display ="none"
            document.getElementById("btn-change-password").style.display ="none"
            document.getElementById("btn-check-code").style.display ="none"
            document.getElementById("input-change-password").style.display = "none"
            document.querySelector("#invalid-pass-para").style.display = "none"
            document.getElementById("input-confirm-change-password").style.display = "none"
            document.querySelector(".success-change-para").style.display = "none"
            document.querySelector(".old-password-para").style.display = "none"
        })
        var inputNumber = document.getElementById("input-number");
        inputNumber.style.display = "none"
   
        inputNumber.addEventListener("input", function(event) {
            var inputValue = event.target.value
            var numericValue = inputValue.replace(/\D/g, '')
            event.target.value = numericValue;
            if(inputNumber.value.length > 0)document.getElementById("wrong-code-para").style.display ="none"
        });
        function togglePasswordVisibility() {
           
            var imgLock = document.getElementById("logoPassword");
             var passwordInput = document.getElementById("loginPassword");
              passwordInput.type = (passwordInput.type === "password") ? "text" : "password";
             imgLock.setAttribute('title', (passwordInput.type === "password") ? 'Show Password' : 'Hide Password');
            imgLock.setAttribute('name', (passwordInput.type === "password") ? 'lock-alt' : 'lock-open-alt');
             var newImgLock = imgLock.cloneNode(true);
             imgLock.parentNode.replaceChild(newImgLock, imgLock);
        }
        function toggleForgotPasswordVisibility() {
           
           var imgLock = document.getElementById("logoNewPassword");
            var passwordInput = document.getElementById("changePassword")
             passwordInput.type = (passwordInput.type === "password") ? "text" : "password";
            imgLock.setAttribute('title', (passwordInput.type === "password") ? 'Show Password' : 'Hide Password');
           imgLock.setAttribute('name', (passwordInput.type === "password") ? 'lock-alt' : 'lock-open-alt');
            var newImgLock = imgLock.cloneNode(true);
            imgLock.parentNode.replaceChild(newImgLock, imgLock);
       } 
       function toggleForgotConfirmPasswordVisibility(){
        var imgLock = document.getElementById("logoConfirmPassword");
            var passwordInput = document.getElementById("confirmChangePassword")
             passwordInput.type = (passwordInput.type === "password") ? "text" : "password";
            imgLock.setAttribute('title', (passwordInput.type === "password") ? 'Show Password' : 'Hide Password');
           imgLock.setAttribute('name', (passwordInput.type === "password") ? 'lock-alt' : 'lock-open-alt');
            var newImgLock = imgLock.cloneNode(true);
            imgLock.parentNode.replaceChild(newImgLock, imgLock);
       }
        var accounts = JSON.parse(localStorage.getItem("accounts")) || [];
        var randomSixDigitNumber =''
        var changeEmailPass = ""
       document.getElementById("btn-send-code").addEventListener("click",()=>{
            var userEmail = document.getElementById("userEmail")
            for(var i = 0;i< accounts.length;i++){
                if(accounts[i].email == userEmail.value){
                  
                    changeEmailPass = accounts[i]
                     randomSixDigitNumber = generateRandomNumber();
                    document.getElementById("forgot-email-para").style.display = "none"
               
                    document.getElementById("btn-check-code").style.display ="block"
                    document.getElementById("btn-send-code").style.display = "none"
                    let params = {
                                        username : accounts[i].username,
                                        code : randomSixDigitNumber,
                                        email :  accounts[i].email
                                    }
                                    // emailjs.send("service_9od123a","template_awxq3ao", params)
                     document.querySelector(".message-code-para").style.display = "block"
                    
                     document.getElementById("forgot-email").style.display = "none"
                     inputNumber.style.display = "block"
                     document.getElementById("input-code").style.display = "block"
                   break
                }else if(accounts[i].email != userEmail.value){
                    document.querySelector(".forgot-email-para").style.display = "block"
                }
            }
       })
       document.getElementById("btn-check-code").addEventListener("click", ()=>{
            
            document.querySelector(".message-code-para").style.display = "none"
            if( randomSixDigitNumber == document.getElementById("input-number").value){
                userEmail.value = ""
                document.getElementById("input-number").value = ""
                document.querySelector("#input-code").style.display = "none"
            document.getElementById("forgot-email").style.display = "none"
                document.getElementById("wrong-code-para").style.display ="none"
                document.getElementById("btn-change-password").style.display ="block"
                document.getElementById("btn-check-code").style.display = "none"
                document.getElementById("input-change-password").style.display = "block"
            document.getElementById("input-confirm-change-password").style.display = "block"
            }else {
                document.getElementById("wrong-code-para").style.display ="block"
            }
       })
       document.getElementById("btn-change-password").addEventListener("click",()=>{
        
        var validPassword = false;
        var validBothPassword = false;
        if(document.getElementById("changePassword").value == changeEmailPass.password){
            validPassword = false;
            document.querySelector(".old-password-para").style.display = "block"
        }else {
            document.querySelector(".old-password-para").style.display = "none"
            validPassword = true;
        }
        if(document.getElementById("changePassword").value != document.getElementById("confirmChangePassword").value){
            document.querySelector("#invalid-pass-para").textContent = "Password does'nt Match."
            document.querySelector("#invalid-pass-para").style.display = "block"
            validBothPassword =false
        }else {
            document.querySelector("#invalid-pass-para").style.display = "none"
            if (document.getElementById("changePassword").value.length < 8){
                
                document.querySelector("#invalid-pass-para").textContent = "Minimum of 8 Characters"
                document.querySelector("#invalid-pass-para").style.display = "block"
                validBothPassword = false;
            }
                else {
                    if(hasNoCapitalLetters(document.getElementById("changePassword").value)){
                        document.querySelector("#invalid-pass-para").textContent = "Password should contain at least 1 Capital Letter."
                        document.querySelector("#invalid-pass-para").style.display = "block"
                        validBothPassword = false;
                    }
                     if (hasNoLetters(document.getElementById("changePassword").value)){
                        document.querySelector("#invalid-pass-para").textContent = "Password should contain at least 1 Letter."
                        document.querySelector("#invalid-pass-para").style.display = "block"
                        validBothPassword = false;
                    }
                     if (!hasNoSpecialCharacters(document.getElementById("changePassword").value)){
                        document.querySelector("#invalid-pass-para").textContent = "Password should contain at least 1 Special Character."
                        document.querySelector("#invalid-pass-para").style.display = "block"
                        validBothPassword = false;
                    }
                    if (hasNoNumbers(document.getElementById("changePassword").value)){
                        document.querySelector("#invalid-pass-para").textContent = "Password should contain at least 1 Number."
                        document.querySelector("#invalid-pass-para").style.display = "block"
                        validBothPassword = false;
                    }
                    else{
                         validBothPassword = true;
                         document.querySelector("#invalid-pass-para").style.display = "none"
                    }
                }
              
            
                if(validPassword && validBothPassword){
                    for (var l = 0; l < accounts.length; l++){
                        if(changeEmailPass.email == accounts[l].email){
                            accounts[l].password = document.getElementById("changePassword").value
                       
                            localStorage.setItem("accounts", JSON.stringify(accounts));
                            document.getElementById("changePassword").value = ""
                            document.getElementById("confirmChangePassword").value = ""
                            document.querySelector(".success-change-para").style.display = "block"
                            document.getElementById("btn-change-password").style.display = "none"
                        }
                        
                    }
                }
            
        }
       })
        var logPara = document.getElementById("log-para");
        logPara.style.display = "none"
        var loggedAccount = JSON.parse(localStorage.getItem("loggedAccount")) || {};
        var adminAccount = JSON.parse(localStorage.getItem("adminAccount")) || [];
     
        loggedAccountNA = ({
                                 userID: "N/A",
                                 email:"N/A",
                                 username: "N/A",
                                 section : "N/A",
                                 password: "N/A",
                                 date: "N/A"
                                });
        localStorage.setItem("loggedAccount", JSON.stringify(loggedAccountNA));
        if(accounts.length < 1 ){
         accounts.push(loggedAccountNA)
          localStorage.setItem("accounts", JSON.stringify(accounts));
        }
        var teachers = [
                {
                    name: "Bulaong",
                    subject: "Animation",
                    email: "bulaong@example.com"
                },
                {
                    name: "Che",
                    subject: "Animation",
                    email: "che@example.com"
                },

                {
                    name: "Garcia",
                    subject: "Computer Programming 1",
                    email: "garcia@example.com"
                },

                {
                    name: "Malacura",
                    subject: "Computer Programming 2",
                    email: "malacura@example.com"
                }
            ];
            localStorage.setItem("adminAccount",JSON.stringify(teachers));
            localStorage.setItem("ifTeacher", false);
            localStorage.setItem("teacher","N/A")
        document.addEventListener("input", ()=>{
            if(document.getElementById("loginUsername").value.length || document.getElementById("loginPassword").value.length > 0)logPara.style.display = "none";
        })
        document.getElementById("btnLogin").addEventListener("click", ()=>{
            var loginUsername = document.getElementById("loginUsername").value;
            var loginPassword = document.getElementById("loginPassword").value;
            var logged = false;
            if(loginPassword !== "" || loginUsername !== ""){
                for (var i = 0; i < accounts.length; i++) {
                        if (((accounts[i].username === loginUsername) || (loginUsername === accounts[i].email)) && accounts[i].password === loginPassword) {
                            var userID = i
                            logged = true;
                            loggedAccount = ({
                                 userID: userID,
                                 email: accounts[i].email,
                                 username: accounts[i].username,
                                 section : accounts[i].section,
                                 password: accounts[i].password,
                                 date: accounts[i].date
                                });
                            localStorage.setItem("loggedAccount", JSON.stringify(loggedAccount));
                            break;
                        }
                    }
                if((loginUsername === "denzh" && loginPassword === "admin1234") ||
                 (loginUsername === "cheraj" && loginPassword === "admin1234") ||
                  (loginUsername === "garcia" && loginPassword === "admin1234") ||
                   (loginUsername === "malacura" && loginPassword === "admin1234")){
                    localStorage.setItem('ifTeacher', true)
                    localStorage.setItem("teacher",loginUsername)
                    localStorage.setItem("teacherName", loginUsername);
                    logged = true;
                }
                    if (logged) {
                        window.location.href = "main.html";
                    } else{
                        logPara.style.display = "block";
                    }
                }else {
                    logPara.style.display = "block";
                }
        });
        function generateRandomNumber() {
            var result = '';
            var characters = '1234567890';
            var charactersLength = characters.length;
            for (var i = 0; i < 6; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }
      loggedAccount = {}
        localStorage.setItem("loggedAccount", JSON.stringify(loggedAccount));
       
      
         
         var createdActs = JSON.parse(localStorage.getItem("createdActs")) || [];
        //  createdActs = []
        //  localStorage.setItem('createdActs', JSON.stringify(createdActs));
       
        // createdActs.push(teachers);
        var passedActs = JSON.parse(localStorage.getItem("passedActs")) || [];
        
        // passedActs = []
        //  localStorage.setItem('passedActs', JSON.stringify(passedActs));
        let docTitle =  document.title
      window.addEventListener("blur",()=>{
        document.title = "Taskmate - Log In"
      })
      window.addEventListener("focus",()=>{
        document.title = docTitle
      })
    </script>
    
</body>
</html>