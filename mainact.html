<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Activities</title>
   <link rel="stylesheet" href="mainactstyle.css">
</head>
<body>

<div class="list-of-act">
        <button class="back-to-main" type="button">Back</button>
    <div class="list-heading">
        <h3></h3>
        <span></span>
    </div>
    <div class="list-of-act-container">
        <div class="list-of-act-box">
            <div class="list-img">
                <img src="#" alt="Image 1" id="imgPic">
            </div>
            <div class="list-of-act-para">
                <span id="dueDate"></span>
                <a href="#" title="wla"></a>
                <p class="score"></p>
                <p class="student-act-descrip" ></p>
            </div>
            <div class="list-inputs">
                <div class="pass-act" id="pass-act">
                    <label for="pass-file" class="custom-file-upload">Choose File</label>
                    <input type="file" name="pass-file" id="pass-file" title="Upload File">
                </div>
                <div class="input-grade" id="input-grade">
                    <label >Score:</label>
                    <input type="number" id="numberInput" title="Score">
                </div>
                <br>
                <div class="comment-box">
                    <label for="comment-area"></label>
                    <textarea name="comment" id="comment-area" cols="30" rows="3" placeholder="Comment"  ></textarea>
                    <div class="file-pass-act" id="file-pass-act">
                        
                    </div>
                </div>
                <br>
                <div class="pass-act-btn">
                    <button type="button" id="btn-pass-act">Pass Activity</button>
                </div>
            </div>
        </div>
      
       
    </div>
</div>
    <script>
          var passedActs = JSON.parse(localStorage.getItem("passedActs")) || [];
        console.log(passedActs)
        var selectedAct = localStorage.getItem("selectedAct");
         var selectedActivity = JSON.parse(selectedAct);
         var ifTeacher = localStorage.getItem("ifTeacher")
          console.log(selectedActivity)
          document.getElementById("numberInput").addEventListener("input", function() {
            var inputValue = parseInt(this.value);
            if (isNaN(inputValue) || inputValue < 0 || inputValue > selectedActivity.actScore) {
                this.value = "";
            }
        });
        var btnPassAct = document.getElementById("btn-pass-act");
       if(ifTeacher == "false"){
        document.querySelector("h3").textContent = selectedActivity.subjectName;
        document.querySelector('span').textContent = selectedActivity.teacherName;
        document.querySelector('a').textContent = selectedActivity.title;
        document.getElementById('imgPic').src = selectedActivity.image;
        document.querySelector('#dueDate').textContent = selectedActivity.dueDate;
        document.querySelector('.student-act-descrip').textContent = selectedActivity.description;
        document.querySelector(".score").textContent = "Score: " + selectedActivity.actScore;
        document.getElementById("pass-act").style.display = "block"
        document.getElementById("numberInput").style.display = "none"
       }else {
          btnPassAct.textContent = "Grade Activity"
          document.querySelector('span').textContent = selectedActivity.teacherName;
          document.querySelector("h3").textContent = selectedActivity.subjectName;
          document.querySelector('a').textContent = selectedActivity.title;
        document.getElementById('imgPic').src = selectedActivity.image;
        document.querySelector('.student-act-descrip').textContent = selectedActivity.description;
        document.querySelector(".score").textContent = "Score: " + selectedActivity.actScore;
        document.getElementById("pass-act").style.display = "none"
        document.getElementById("numberInput").style.display = "block"
        document.getElementById("input-grade").style.display = "block"
       }
        document.querySelector(".back-to-main").addEventListener("click",()=>{
            window.location.href = "main.html";
        })
        document.getElementById('imgPic').addEventListener('click', function() {
            this.classList.toggle('full-view');
         });
        //inputs
        let fileContent;
        document.getElementById('pass-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileType = file.type;
                fileContent = e.target.result;
                
                if (fileType.startsWith('image')) {
                    const imageViewer = document.getElementById('file-pass-act');
                    const imgElement = document.createElement('img');
                    imgElement.src = fileContent;
                    imgElement.alt = 'Uploaded Image';
                    imgElement.style.maxWidth = '100%';
                    imageViewer.innerHTML = '';
                    imageViewer.appendChild(imgElement);
                } else if (fileType === 'application/pdf') {
                    
                    const pdfViewer = document.getElementById('file-pass-act');
                    const embedElement = document.createElement('embed');
                    embedElement.src = fileContent;
                    embedElement.type = 'application/pdf';
                    embedElement.style.width = '100%';
                    embedElement.style.height = '600px';
                    pdfViewer.innerHTML = '';
                    pdfViewer.appendChild(embedElement);
                } else {
                    // Unsupported file type
                    console.log("bawal")
                }
            };
            
            reader.readAsDataURL(file);
        });
        let passedInfos = JSON.parse(localStorage.getItem('passedActs')) || [];
        var loggedAccount = JSON.parse(localStorage.getItem("loggedAccount")) || {};
        
        btnPassAct.addEventListener("click", ()=>{
            if(ifTeacher == "false"){
                document.getElementById("input-grade").style.display = "none"
                let passInfos = {
                    studentActComment : document.getElementById("comment-area").value,
                    studentPassedFile : "logo.png", //fileContent,
                    actScore : selectedActivity.actScore,
                    studentTeacher : selectedActivity.teacherName,
                    passedSubj : selectedActivity.subjectName,
                    studentName : loggedAccount.username,
                    studentSection : loggedAccount.section,
                    actTitle : selectedActivity.title,
                    teacher : selectedActivity.teacher,
                    studentScore : "0"
                    
            }
            passedInfos.push(passInfos)
            localStorage.setItem('passedActs', JSON.stringify(passedInfos));
            }else {
                
                 var studentScore= document.getElementById("numberInput").value
                passedActs.forEach(passedAct => {
                    if(selectedActivity.teacherName == passedAct.studentName){
                        passedAct.studentScore = studentScore
                        localStorage.setItem('passedActs', JSON.stringify(passedActs));
                    }
                });
            }
            //  window.location.href = "main.html";
        })
      
    </script>
</body>
</html>
